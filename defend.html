<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defense | OE Training</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { neon: '#39FF14', dark: '#111111', card: '#1F1F1F', darklighter: '#2A2A2A' },
                    fontFamily: { display: ['Montserrat', 'sans-serif'], mono: ['Roboto Mono', 'monospace'] }
                }
            }
        }
    </script>
</head>
<body class="bg-dark text-gray-200 h-screen flex flex-col">

    <nav class="bg-black border-b border-neon/30 p-4 flex justify-between items-center z-50 shrink-0">
        <a href="mainhome page.html" class="flex items-center gap-2 text-xl md:text-2xl font-display font-black uppercase hover:text-neon transition">
            <span>⚽</span>
            <span>OE <span class="text-neon">TRAINING</span></span>
        </a>
        <div class="hidden md:flex space-x-6 text-sm font-bold uppercase">
            <a href="mainhome page.html" class="hover:text-neon">Home</a>
            <a href="main attack page.html" class="hover:text-neon">Attack</a>
            <a href="defend.html" class="text-neon border-b border-neon">Defense</a>
            <a href="skills.html" class="hover:text-neon">Skills</a>
        </div>
    </nav>

    <main class="container mx-auto p-6 flex-1">
        <header class="mb-8">
            <h1 class="text-4xl md:text-6xl font-display font-black uppercase">Defense Library</h1>
            <p class="text-gray-400 mt-2">10 defense techniques with steps, videos, and mark-as-mastered tracking.</p>
            <div class="w-full bg-gray-800 h-2 mt-4"><div id="prog-def" class="bg-neon h-full w-0"></div></div>
        </header>

        <section id="list" class="grid md:grid-cols-2 gap-6"></section>
    </main>

    <!-- Media modal (used for example YouTube demos) -->
    <div id="media-modal" class="hidden fixed inset-0 z-50 items-center justify-center bg-black/70 p-4" aria-hidden="true">
        <div class="bg-card w-full max-w-6xl rounded-lg overflow-hidden">
            <div class="p-4 flex justify-between items-start border-b border-gray-800">
                <h3 id="modal-title" class="font-bold text-lg"></h3>
                <div class="flex items-center gap-3">
                    <button id="modal-mark" class="px-3 py-1 bg-neon text-black font-bold rounded">Mark as Mastered</button>
                    <button id="modal-close" class="text-gray-400 hover:text-white">Close</button>
                </div>
            </div>
            <div class="px-4 pb-4">
                <p id="modal-desc" class="text-gray-400"></p>
                <ul id="modal-steps" class="mt-3 text-sm text-gray-400"></ul>
            </div>
        </div>
    </div>

    <script>
        const data = [
            {id:1, title:'Interception & Reading Play', desc:'Anticipate passes and cut lines.', steps:['Watch ball and shoulders','Step into passing lane','Secure the ball']},
            {id:2, title:'Tackle Timing', desc:'Commit at the precise moment.', steps:['Jockey first','Commit low and balanced','Follow through']},
            {id:3, title:'Jockeying & Containment', desc:'Delay the attacker safely.', steps:['Stay low','Short quick steps','Shepherd to touchline']},
            {id:4, title:'Block Shot', desc:'Use body to block dangerous shots.', steps:['Stay between ball and goal','Time jump or slide','Recover quickly']},
            {id:5, title:'Clearing under Pressure', desc:'Safety-first clearances.', steps:['Check teammates','Head up','Clear to space not to feet']},
            {id:6, title:'Channeling to Weak Foot', desc:'Force attacker onto non-preferred side.', steps:['Position body','Angled pressure','Tackle or intercept']},
            {id:7, title:'Recovery Run', desc:'Close down regained positions.', steps:['Accelerate backward','Angle to cover','Communicate']},
            {id:8, title:'Marking & Tracking', desc:'Stay tight and aware.', steps:["Know runner's tendencies","Stay between runner and goal","Use peripheral vision"]},
            {id:9, title:'Pressured Passing', desc:'Fast outlet passes to relieve pressure.', steps:['Open body early','Short sharp pass','Follow the pass']},
            {id:10, title:'Set-piece Organization', desc:'Defend corners and free-kicks efficiently.', steps:['Assign marks','Win first challenge','Clear with purpose']}
        ];

        const storageKey = 'mastered_defend';
        const videoPrefix = 'video_defend_';
        let currentModal = {id: null, type: 'defend'};

        function getYouTubeEmbedUrl(input, fallbackSearch){
            if(!input) return 'https://www.youtube.com/embed?listType=search&list=' + encodeURIComponent(fallbackSearch);
            try{
                if(input.includes('youtube.com/embed') || input.includes('youtube-nocookie.com/embed')) return input;
                let m = input.match(/youtu\.be\/([A-Za-z0-9_-]+)/);
                if(m && m[1]) return 'https://www.youtube.com/embed/' + m[1];
                m = input.match(/[?&]v=([A-Za-z0-9_-]+)/);
                if(m && m[1]) return 'https://www.youtube.com/embed/' + m[1];
                if(/^[A-Za-z0-9_-]{6,}$/.test(input)) return 'https://www.youtube.com/embed/' + input;
                return 'https://www.youtube.com/embed?listType=search&list=' + encodeURIComponent(fallbackSearch);
            }catch(e){
                return 'https://www.youtube.com/embed?listType=search&list=' + encodeURIComponent(fallbackSearch);
            }
        }

        function render(){
            const container = document.getElementById('list');
            const mastered = JSON.parse(localStorage.getItem(storageKey) || '[]');
            document.getElementById('prog-def').style.width = (mastered.length / data.length) * 100 + '%';

            container.innerHTML = data.map(s => `
                <div class="bg-card p-4 border border-gray-800 rounded-lg flex items-start gap-4">
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold uppercase">${s.title}</h3>
                            <span class="text-gray-400 text-sm">Technique ${s.id}</span>
                        </div>
                        <p class="text-gray-400 text-sm mb-3">${s.desc}</p>
                        <div class="flex gap-2">
                            <button onclick="toggle(${s.id})" class="px-3 py-2 text-sm font-bold uppercase border ${mastered.includes(s.id) ? 'bg-neon text-black border-neon' : 'border-gray-700 text-gray-300'}">${mastered.includes(s.id) ? 'Mastered ✔' : 'Mark'}</button>
                            <button onclick="openDefendModal(${s.id})" class="px-3 py-2 text-sm border border-gray-700 text-gray-300">Details</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function setVideo(id){
            const key = videoPrefix + id;
            const cur = localStorage.getItem(key) || '';
            const url = prompt('Paste YouTube URL or video ID for this technique (leave blank to remove):', cur);
            if(url === null) return;
            if(url.trim() === ''){ localStorage.removeItem(key); alert('Video removed.'); }
            else { localStorage.setItem(key, url.trim()); alert('Video saved.'); }
            render();
        }

        function toggle(id){
            let m = JSON.parse(localStorage.getItem(storageKey) || '[]');
            if(m.includes(id)) m = m.filter(x=>x!==id); else m.push(id);
            localStorage.setItem(storageKey, JSON.stringify(m));
            render();
        }


        function openDefendModal(id){
            const s = data.find(x=>x.id===id);
            const explanations = {
                1: 'Interception & Reading Play: Used to anticipate and cut passing lanes. Effective for regaining possession and stopping attacks.',
                2: 'Tackle Timing: Used to win the ball at the right moment. Effective for clean challenges and avoiding fouls.',
                3: 'Jockeying & Containment: Used to delay attackers and force errors. Effective for defensive stability.',
                4: 'Block Shot: Used to prevent dangerous shots on goal. Effective for protecting the net.',
                5: 'Clearing under Pressure: Used to safely clear the ball from danger. Effective for relieving defensive pressure.',
                6: 'Channeling to Weak Foot: Used to force attackers onto their non-preferred side. Effective for reducing attacking threat.',
                7: 'Recovery Run: Used to regain defensive position quickly. Effective for stopping counter-attacks.',
                8: 'Marking & Tracking: Used to stay close to opponents. Effective for preventing scoring chances.',
                9: 'Pressured Passing: Used to pass out of tight situations. Effective for maintaining possession.',
                10: 'Set-piece Organization: Used to defend corners and free-kicks. Effective for team defensive structure.'
            };
            currentModal.id = s.id;
            document.getElementById('modal-title').textContent = s.title;
            document.getElementById('modal-desc').textContent = explanations[s.id] || s.desc;
            document.getElementById('modal-steps').innerHTML = '';
            // Update modal-mark button label and style
            const mastered = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const markBtn = document.getElementById('modal-mark');
            if (mastered.includes(s.id)) {
                markBtn.textContent = 'Unmark as Mastered';
                markBtn.className = 'px-3 py-1 bg-gray-700 text-white font-bold rounded';
            } else {
                markBtn.textContent = 'Mark as Mastered';
                markBtn.className = 'px-3 py-1 bg-neon text-black font-bold rounded';
            }
            const modal = document.getElementById('media-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            modal.setAttribute('aria-hidden','false');
        }



        function toggleFromModal(id, storageKey){
            let m = JSON.parse(localStorage.getItem(storageKey) || '[]');
            if(m.includes(id)) m = m.filter(x=>x!==id); else m.push(id);
            localStorage.setItem(storageKey, JSON.stringify(m));
            // close modal and refresh
            closeModal();
            render();
        }

        function closeModal(){
            const modal = document.getElementById('media-modal');
            modal.classList.remove('flex');
            modal.classList.add('hidden');
            modal.setAttribute('aria-hidden','true');
        }

        render();
        // Attach modal event listeners after DOM is ready and elements exist
        // Use event delegation for modal actions
        document.getElementById('media-modal').addEventListener('click', function(e) {
            if (e.target.id === 'modal-close') {
                e.stopPropagation();
                closeModal();
            } else if (e.target === this) {
                closeModal();
            }
        });
        document.getElementById('modal-mark').addEventListener('click', function() {
            if (currentModal.id != null) {
                let m = JSON.parse(localStorage.getItem(storageKey) || '[]');
                if(m.includes(currentModal.id)) m = m.filter(x=>x!==currentModal.id); else m.push(currentModal.id);
                localStorage.setItem(storageKey, JSON.stringify(m));
                // Update button label and style immediately
                const markBtn = document.getElementById('modal-mark');
                if (m.includes(currentModal.id)) {
                    markBtn.textContent = 'Unmark as Mastered';
                    markBtn.className = 'px-3 py-1 bg-gray-700 text-white font-bold rounded';
                } else {
                    markBtn.textContent = 'Mark as Mastered';
                    markBtn.className = 'px-3 py-1 bg-neon text-black font-bold rounded';
                }
                render();
            }
        });
    </script>
</body>
</html>